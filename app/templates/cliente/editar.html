<!-- Usuario: Erick sulca
	 fecha: 01/06/18
	 última modificación: 12/06/18
	 Descripción: se agrego la función getMapa, y toggleBounce para hacer más dinámico el marcador del mapa -->

{% extends "base.html" %}

{% block imports %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
{% endblock %}

{% block title %}
Editar Cliente
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div class="card-header-right">
            <ul class="list-unstyled card-option">
                <li><i class="fa fa fa-wrench open-card-option"></i></li>
                <li><i class="fa fa-window-maximize full-card"></i></li>
                <li><i class="fa fa-minus minimize-card"></i></li>
                <li><i class="fa fa-refresh reload-card"></i></li>
                <li><i class="fa fa-trash close-card"></i></li>
            </ul>
        </div>
    </div>
    <div class="card-block table-border-style">
        <div class="table-responsive">
            <div class="white-box">
                <h3 class="box-title">Formulario de nuevo cliente</h3>
                <form action="." method="post" enctype="multipart/form-data">
					{% csrf_token %}
				<ul>

				{% load widget_tweaks %}
				{% csrf_token %}
					<div class="form-group">
				    {% for field in form %}
						{{ field.errors }}
						{{ field.label_tag }}</br>
						{{ field|add_class:"form-control" }}
				    {% endfor %}

				</ul>
				<ul>
					<hr>
					<div class="col-12  justify-content-center">
					<div id="mapid" style=" height: 400px;" class="justify-content-center"></div>
					</div>
					<button type="submit" class="btn btn-success">Actualizar</button>
				</ul>
				</form>
	    	</div>
	    </div>
    </div>
</div>
{% endblock %}
{% block footer  %}
<script type="text/javascript">
	$(document).ready(function() {
		var map ;
		var theMarker  = {};
		var time = 1;
		var coordenadas = [-12.6150756, -73.7913895]
		var map = L.map('mapid').setView(coordenadas, 16);
		L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
			maxZoom: 18,
			id: 'mapbox/streets-v11',
			tileSize: 512,
			zoomOffset: -1,
			accessToken: 'pk.eyJ1IjoiZXJpaWNrIiwiYSI6ImNsajV5OTRhbTBnNnMzZ29yemFieXZidTIifQ.kCX-VyaXd_CF7d2GrbqYPQ'
		}).addTo(map);

		addCoords(coordenadas)

		console.log(theMarker)
		function onMapClick(e) {
			console.log(theMarker)
			//theMarker = new L.Marker(e.latlng, {draggable:true});
        	//map.addLayer(theMarker);
			coordenadas = e.latlng
			addCoords(coordenadas)
			$(id_latitud).val(coordenadas['lat'])
			$(id_longitud).val(coordenadas['lng'])
			//L.marker(e.latlng).addTo(map);
		}
		
		function addCoords(coordenadas){
			map.removeLayer(theMarker)
			theMarker = L.marker(coordenadas, {draggable:true});
        	map.addLayer(theMarker);
        	//L.marker(coordenadas).addTo(map);
		}

		map.on('click', onMapClick);
	});
</script>
{% endblock %}
